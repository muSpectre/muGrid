<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="Fast Fourier Transform" href="FFT.html"><link rel="prev" title="Getting Started" href="GettingStarted.html">

    <!-- Generated with Sphinx 9.1.0 and Furo 2025.12.19 -->
        <title>Python Bindings - µGrid 0.104.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">µGrid 0.104.0
 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">µGrid 0.104.0
 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Python Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="FFT.html">Fast Fourier Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU.html">GPU Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinAlg.html">Linear Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operators.html">Linear Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cplusplus.html">C++ Bindings</a></li>
<li class="toctree-l1"><a class="reference internal" href="Architecture.html">Code Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="PythonAPI.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="CplusplusAPI.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="CodingConvention.html">Coding Convention</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/Python.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="python-bindings">
<h1>Python Bindings<a class="headerlink" href="#python-bindings" title="Link to this heading">¶</a></h1>
<section id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Link to this heading">¶</a></h2>
<p>The µGrid library handles field quantities, i.e. scalar, vectors or tensors,
that vary in space. It supports only a uniform discretization of space. In the
language of µGrid, we call the discrete coordinates <strong>pixels</strong>. Each pixel
is associated with a physical position in space. µGrid supports fields in
two and three dimensional Cartesian grids. Note that a common name for a pixel
in three dimensions is a <strong>voxel</strong>, but we refer to it as a pixel throughout
this documentation.</p>
<p>Each pixel
can be subdivided into logical elements, for example into a number of
support points for numerical quadrature. These subdivisions are called
<strong>sub-points</strong>. Note that while µGrid understands the physical location of
each <em>pixel</em>, the <em>sub-points</em> are logical subdivisions and not associated
with any position within the pixel. Each <em>sub-point</em> carries the field quantity,
which can be a scalar, vector or any type of tensor. The field quantity is
called the <strong>component</strong>.</p>
</section>
<section id="multidimensional-arrays">
<h2>Multidimensional arrays<a class="headerlink" href="#multidimensional-arrays" title="Link to this heading">¶</a></h2>
<p>Each µGrid field has a representation in a multidimensional array. This
representation is used when accessing a field with Python via <a class="reference external" href="https://numpy.org/">numpy</a>
or when writing the field to a file. The default representation has the shape</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">sub</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
<p>As a concrete example, a second-rank tensor (for example the deformation
gradient) living on two quadrature points in two dimensions with a spatial
discretization of 11 x 12 grid points would have the following shape:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the components are omitted if there is only a single component (i.e.
a scalar value), but the sub-points are always included even if there is only
a single sub-point.</p>
<p>Throughout the code, we call the field quantities <strong>entries</strong>. For example,
<cite>nb_pixels</cite> refers to the number of pixels while <cite>nb_sub_pts</cite> refers to the
number of sub-points per pixel. <cite>nb_entries</cite> is then the product of the two.</p>
<p>The above field has another multidimensional array representation that folds
the sub-point into the last dimension of the components. For the above example,
this means a multidimensional array of shape:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Depending on the numerical use case, it can be useful to work with either
representation.</p>
</section>
<section id="field-collections">
<h2>Field collections<a class="headerlink" href="#field-collections" title="Link to this heading">¶</a></h2>
<p>In µGrid, fields are grouped into field collections. A field collection knows
about the spatial discretization of the fields, but each field can differ in number of
sub-points and components.</p>
<p>There are two kinds of field collections:</p>
<ul class="simple">
<li><p>A <strong>global</strong> collection that groups fields that have values at all pixels.</p></li>
<li><p>A <strong>local</strong> collection that groups fields that have values only at a subset of pixels.
An example would be the elastic constants of a material that only exists at
certain locations in the domain.</p></li>
</ul>
<p>The following example shows how to initialize a field collection and create scalar fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span><span class="n">nb_grid_pts</span><span class="p">)</span>

<span class="c1"># Get a scalar (real-valued) field</span>
<span class="c1"># This call creates a new field if it does not exist.</span>
<span class="n">field</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;my-real-valued-field&quot;</span><span class="p">)</span>

<span class="c1"># Check the registered fields</span>
<span class="k">assert</span> <span class="n">fc</span><span class="o">.</span><span class="n">field_names</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;my-real-valued-field&quot;</span><span class="p">]</span>

<span class="c1"># Fill the field with random numbers</span>
<span class="n">field</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">nb_grid_pts</span><span class="p">)</span>

<span class="c1"># Set a specific value</span>
<span class="n">field</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>

<span class="c1"># Get the field, but now into a different variable</span>
<span class="n">field2</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;my-real-valued-field&quot;</span><span class="p">)</span>

<span class="c1"># Check that the value is the same</span>
<span class="k">assert</span> <span class="n">field2</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>The first argument to the constructor of <cite>FieldCollection</cite> is the spatial dimension.
Fields are then registered with the field accessor methods of the field collection,
e.g. <cite>real_field</cite> in the example above. Fields are <em>named</em>, and the name needs to be
unique. Accessing a field of the same name yield the same field object.</p>
<p>Note the <cite>FieldCollection</cite> additionally has register methods, e.g. <cite>register_real_field</cite>.
The different to <cite>real_field</cite> method is that the explicit registration of the field fails if
it already exists, while the accessor method <cite>real_field</cite> registers it if it does not exist
but returns the existing field if it does. You can also query a field with <cite>get_field</cite>,
which will raise an exception if the field does not exist.</p>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Link to this heading">¶</a></h2>
<p>In the above example, we registered a scalar field, which has no components. Vector or
tensor-valued field can be defined by specifying either simply a number of components or
the shape of the components explicitly. The following example shows how to create a
tensor-valued field that contains 2 x 2 matrices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span><span class="n">nb_grid_pts</span><span class="p">)</span>

<span class="c1"># Get a tensor-field (for example to represent the strain)</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Fill the field with random numbers</span>
<span class="n">strain</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb_grid_pts</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that there is a difference between a scalar field and a field with a single component.
When a single component is specified, this is reflected in the shape of the field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span><span class="n">nb_grid_pts</span><span class="p">)</span>

<span class="c1"># Get a scalar field</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">)</span>
<span class="c1"># The 1 is the number of sub points</span>
<span class="k">assert</span> <span class="n">phase</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">nb_grid_pts</span><span class="p">]</span>

<span class="c1"># Get a single component field</span>
<span class="n">single</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="c1"># Now there is an explicit component dimension of 1</span>
<span class="k">assert</span> <span class="n">single</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">nb_grid_pts</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="sub-points">
<h2>Sub-points<a class="headerlink" href="#sub-points" title="Link to this heading">¶</a></h2>
<p>A pixel can be subdivided into multiple sub-points, each of which holds a value (scalar,
vector or tensor) of the field. Examples for sub-points are elements or quadrature points
in a the finite element method.</p>
<p>Sub-points are named, e.g. common names would be <cite>element</cite> for subdivision into elements or
<cite>quad</cite> for quadrature points. The name of the subdivision must be specified when the field
is created.</p>
<p>The following example initializes a three-dimension grid with
a sub-division of each pixel into five elements:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span><span class="n">nb_grid_pts</span><span class="p">,</span> <span class="n">nb_sub_pts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>

<span class="c1"># Get a tensor-field (for example to represent the strain)</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;element&quot;</span><span class="p">)</span>

<span class="c1"># Fill the field with random numbers</span>
<span class="n">strain</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb_grid_pts</span><span class="p">))</span>

<span class="c1"># Note that the convenience accessor `p` yields the same field but a different shape</span>
<span class="n">strain</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb_grid_pts</span><span class="p">))</span>
</pre></div>
</div>
<p>The example demonstrates two ways of accessing the field. The convenience accessor <cite>p</cite> (that
we also used in the above examples) and the new accessor <cite>s</cite>. Both yield a numpy array that is
a view on the underlying data, but with different shapes. The <cite>s</cite> accessor has the shape
<cite>(components, sub-points, pixels)</cite> and exposes the sub-points explicitly. The <cite>p</cite> accessor folds
the sub-points into the last dimension of the components.</p>
</section>
<section id="convolutions">
<h2>Convolutions<a class="headerlink" href="#convolutions" title="Link to this heading">¶</a></h2>
<p>A common operation in numerical analysis is the convolution of a field with a short-ranged stencil. µGrid has utility
functions that make this convolution simple. A convolution turns a field defined on nodal points into a field defined
on quadrature points. This means field of shape</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">nodal</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
<p>is turned into a field of shape</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">quadrature</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
<p>where the same convolution is applied to each component. Note that the convolution operation itself may have multiple
components (which we will refer to as operators in the following), meaning that the output field may have the shape</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">operators</span><span class="p">,</span> <span class="n">quadrature</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
<p>In mathematical notation, the convolution operation can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_{c,o,q,p} = \sum_{n} \sum_{k} s_{o,q,n,k} g_{c,n,p+k}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(f\)</span> is the output field, <span class="math notranslate nohighlight">\(g\)</span> is the input field, <span class="math notranslate nohighlight">\(s\)</span> is the stencil, <span class="math notranslate nohighlight">\(o\)</span> are the operators, <span class="math notranslate nohighlight">\(c\)</span> are the components,
<span class="math notranslate nohighlight">\(q\)</span> are the quadrature points, <span class="math notranslate nohighlight">\(n\)</span> are the nodal points, <span class="math notranslate nohighlight">\(p\)</span> are the pixels and <span class="math notranslate nohighlight">\(k\)</span> runs over the stencil width
(possibly in 2 or 3 dimensions).</p>
<p>The convolution operation also has a transpose operation that turns a field defined on quadrature points into a field defined on nodal points.
In mathematical notation, the transpose convolution is written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[g_{c,n,p} = \sum_{o} \sum_{q} \sum_{k} s_{o,q,n,k} f_{c,o,q,p-k}\]</div>
</div>
<p>with the same stencil <span class="math notranslate nohighlight">\(s\)</span> as above.</p>
<p>As an example, we consider the gradient of a two dimensional field with a single nodal point.
If we use two linear finite elements per pixel, we can represent the derivative by two quadrature points per pixel.
The gradient itself has two components, one for each direction of the gradient, which means we need two operators
to represent it. The stencil then has the shape</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">operators</span><span class="p">,</span> <span class="n">quadrature</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">nodal</span><span class="o">-</span><span class="n">points</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
<p>or in this specific case</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>because we are only considering a two-dimensional problem where there are two operators of the gradient.</p>
<p>Note that the stencil can be of a lower dimensional shape, in which case missing dimensions are assumed to
be unity. It is assumed that first <cite>nodel-points</cite>, then <cite>quadrature-points</cite> and finally <cite>operators</cite> are
missing. This means we can represent a simple forward-differences gradient operator in two dimensions as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mpi4py</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPI</span>

    <span class="n">comm</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">Communicator</span><span class="p">(</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">Communicator</span><span class="p">()</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Add some ghosts for computing</span>
<span class="n">nb_ghosts_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">nb_ghosts_right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span>
    <span class="n">nb_grid_pts</span><span class="p">,</span>
    <span class="n">nb_sub_pts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;quad&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="n">nb_ghosts_left</span><span class="o">=</span><span class="n">nb_ghosts_left</span><span class="p">,</span>
    <span class="n">nb_ghosts_right</span><span class="o">=</span><span class="n">nb_ghosts_right</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Get nodal field</span>
<span class="n">nodal_field</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;nodal-field&quot;</span><span class="p">)</span>

<span class="c1"># Get quadrature field of shape (2, quad, nx, ny)</span>
<span class="n">quad_field</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;quad-field&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;quad&quot;</span><span class="p">)</span>

<span class="c1"># Fill nodal field with a sine-wave</span>
<span class="c1"># Generate grid coordinates</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">),</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<span class="n">nodal_field</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">nx</span><span class="p">)</span>
<span class="c1"># Padding to mimic periodic boundary (sine wave is also periodic)</span>
<span class="n">nodal_field</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
    <span class="n">nodal_field</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nb_ghosts_left</span><span class="p">,</span> <span class="n">nb_ghosts_right</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span>
<span class="p">)</span>

<span class="c1"># Derivative stencil of shape (2, quad, 2, 2)</span>
<span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span>  <span class="c1"># Derivative in x-direction</span>
            <span class="p">[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]],</span>  <span class="c1"># Bottom-left triangle (first quadrature point)</span>
            <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]],</span>  <span class="c1"># Top-right triangle (second quadrature point)</span>
        <span class="p">],</span>
        <span class="p">[</span>  <span class="c1"># Derivative in y-direction</span>
            <span class="p">[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]],</span>  <span class="c1"># Bottom-left triangle (first quadrature point)</span>
            <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]],</span>  <span class="c1"># Top-right triangle (second quadrature point)</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GenericLinearOperator</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">gradient</span><span class="p">)</span>

<span class="c1"># Apply the gradient operator to the nodal field and write result to the quad field</span>
<span class="n">op</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">nodal_field</span><span class="p">,</span> <span class="n">quad_field</span><span class="p">)</span>

<span class="c1"># Check that the quadrature field has the correct derivative</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span>
    <span class="c1"># Even though the quadrature point can have different locations, because the</span>
    <span class="c1"># gradient stencil is linearly interpolating, it should compare against the</span>
    <span class="c1"># analytic value evaluated at the middle of two grid points, hence (x + 0.5)</span>
    <span class="n">quad_field</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">nx</span><span class="p">)</span> <span class="o">/</span> <span class="n">nx</span><span class="p">,</span>
    <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">quad_field</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="array-accessors">
<h2>Array accessors<a class="headerlink" href="#array-accessors" title="Link to this heading">¶</a></h2>
<p>Each field provides four accessors that return views into the underlying field data
as multidimensional arrays. For fields on the host (CPU), these return numpy arrays.
For fields on the GPU, these return CuPy arrays. See the <a class="reference internal" href="GPU.html"><span class="doc">GPU Computing</span></a> chapter
for details on GPU computing.</p>
<p>The accessors differ in two ways:</p>
<ol class="arabic simple">
<li><p><strong>Layout</strong>: SubPt (<code class="docutils literal notranslate"><span class="pre">s</span></code>) vs Pixel (<code class="docutils literal notranslate"><span class="pre">p</span></code>)</p></li>
<li><p><strong>Ghost regions</strong>: Excluded (<code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">p</span></code>) vs Included (<code class="docutils literal notranslate"><span class="pre">sg</span></code>, <code class="docutils literal notranslate"><span class="pre">pg</span></code>)</p></li>
</ol>
<section id="subpt-vs-pixel-layout">
<h3>SubPt vs Pixel layout<a class="headerlink" href="#subpt-vs-pixel-layout" title="Link to this heading">¶</a></h3>
<p>The <strong>SubPt layout</strong> (<code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">sg</span></code>) exposes the sub-points as an explicit dimension:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">displacement_field</span><span class="o">.</span><span class="n">s</span>  <span class="c1"># shape: (components, sub_pts, *spatial_dims)</span>
</pre></div>
</div>
<p>The <strong>Pixel layout</strong> (<code class="docutils literal notranslate"><span class="pre">p</span></code>, <code class="docutils literal notranslate"><span class="pre">pg</span></code>) folds the sub-points into the last
dimension of the components:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">displacement_field</span><span class="o">.</span><span class="n">p</span>  <span class="c1"># shape: (components * sub_pts, *spatial_dims)</span>
</pre></div>
</div>
<p>The SubPt layout is useful when you need to operate on sub-points separately,
while the Pixel layout is convenient for operations that treat all sub-point
values uniformly.</p>
</section>
<section id="with-vs-without-ghost-regions">
<h3>With vs without ghost regions<a class="headerlink" href="#with-vs-without-ghost-regions" title="Link to this heading">¶</a></h3>
<p>When using domain decomposition with ghost regions (for stencil operations),
the accessors ending in <code class="docutils literal notranslate"><span class="pre">g</span></code> include the ghost cells:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Excluding ghost regions (interior domain only)</span>
<span class="n">displacement_field</span><span class="o">.</span><span class="n">s</span>   <span class="c1"># SubPt layout, no ghosts</span>
<span class="n">displacement_field</span><span class="o">.</span><span class="n">p</span>   <span class="c1"># Pixel layout, no ghosts</span>

<span class="c1"># Including ghost regions (full local domain with ghosts)</span>
<span class="n">displacement_field</span><span class="o">.</span><span class="n">sg</span>  <span class="c1"># SubPt layout, with ghosts</span>
<span class="n">displacement_field</span><span class="o">.</span><span class="n">pg</span>  <span class="c1"># Pixel layout, with ghosts</span>
</pre></div>
</div>
<p>For fields without ghost regions, <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">sg</span></code> (and <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">pg</span></code>)
return views of the same shape.</p>
<p>The ghost-excluding accessors (<code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">p</span></code>) are typically used for computations
on the interior domain, while ghost-including accessors (<code class="docutils literal notranslate"><span class="pre">sg</span></code>, <code class="docutils literal notranslate"><span class="pre">pg</span></code>) are
used for operations that need to access or modify the full buffer including
ghost cells.</p>
<p>The entries of the field occur as the first indices in the multidimensional
because a numerical code is typically vectorized of the spatial domain, i.e.
we carry out the same operation on each pixel but not on each component.
This means for the above displacement field, we can simply get the components
of the field from</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span> <span class="o">=</span> <span class="n">displacement_field</span><span class="o">.</span><span class="n">s</span>
</pre></div>
</div>
<p>Each of the variable <cite>ux</cite>, <cite>uy</cite>, and <cite>uz</cite> is a three-dimensional array with shape
<cite>(2, 11, 12)</cite>. <em>numpy</em>’s
<a class="reference external" href="https://numpy.org/doc/stable/user/basics.broadcasting.html">broadcasting rules</a>
make it simple to vectorize over pixels,
for example normalizing the displacement field could look like:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">displacement_field</span><span class="o">.</span><span class="n">s</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ux</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">uy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">uz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the default storage order of the field is column-major, which means the
field components are stored next to each other in memory.</p>
</section>
</section>
<section id="i-o">
<h2>I/O<a class="headerlink" href="#i-o" title="Link to this heading">¶</a></h2>
<p>Fields can be written to disk in the <a class="reference external" href="https://en.wikipedia.org/wiki/NetCDF">NetCDF</a> format.
µGrid uses <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/">Unidata NetCDF</a> when build
with just serial capabilities and <a class="reference external" href="https://parallel-netcdf.github.io/">PnetCDF</a> when build
with MPI enabled.</p>
<p>I/O is handled by the <cite>FileIONetCDF</cite> class. The following example shows how to write all fields
from a field collection to disk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">muGrid</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">has_netcdf</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IO example is skipped: muGrid was built without NetCDF support&quot;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Two dimensional grid</span>
<span class="n">nb_grid_pts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">GlobalFieldCollection</span><span class="p">(</span><span class="n">nb_grid_pts</span><span class="p">,</span> <span class="n">nb_sub_pts</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>

<span class="c1"># Get a tensor-field (for example to represent the strain)</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">real_field</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;element&quot;</span><span class="p">)</span>

<span class="c1"># Fill the field with random numbers</span>
<span class="n">strain</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb_grid_pts</span><span class="p">))</span>

<span class="c1"># Initialize a file I/O object (using string for open mode)</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">muGrid</span><span class="o">.</span><span class="n">FileIONetCDF</span><span class="p">(</span><span class="s2">&quot;example.nc&quot;</span><span class="p">,</span> <span class="n">open_mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span>
<span class="n">file</span><span class="o">.</span><span class="n">register_field_collection</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>  <span class="c1"># Register the field collection with the file</span>
<span class="n">file</span><span class="o">.</span><span class="n">append_frame</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>  <span class="c1"># Write all fields of the field collection to the file</span>
</pre></div>
</div>
<p>The file has the following structure (output of <cite>ncdump -h</cite>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">netcdf</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="p">{</span>
<span class="nl">dimensions</span><span class="p">:</span>
<span class="w">        </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UNLIMITED</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="c1">// (1 currently)</span>
<span class="w">        </span><span class="n">tensor_dim__strain</span><span class="mi">-0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">;</span>
<span class="w">        </span><span class="n">tensor_dim__strain</span><span class="mi">-1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">;</span>
<span class="w">        </span><span class="n">subpt__element</span><span class="mi">-5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">;</span>
<span class="w">        </span><span class="n">nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">;</span>
<span class="w">        </span><span class="n">ny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">;</span>
<span class="w">        </span><span class="n">nz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">;</span>
<span class="nl">variables</span><span class="p">:</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="nf">strain</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="n">tensor_dim__strain</span><span class="mi">-0</span><span class="p">,</span><span class="w"> </span><span class="n">tensor_dim__strain</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">subpt__element</span><span class="mi">-5</span><span class="p">,</span><span class="w"> </span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">,</span><span class="w"> </span><span class="n">nz</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="nl">strain</span><span class="p">:</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;no unit provided&quot;</span><span class="w"> </span><span class="p">;</span>

<span class="c1">// global attributes:</span>
<span class="w">                </span><span class="o">:</span><span class="n">creation_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;01-06-2024 (d-m-Y)&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">creation_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;23:02:06 (H:M:S)&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">last_modified_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;01-06-2024 (d-m-Y)&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">last_modified_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;23:02:06 (H:M:S)&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">muGrid_version_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;µGrid version: 0.90.1+40-g5bc73b30</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">muGrid_git_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;5bc73b305881ef837ce6598568d41eb3d0307c41&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">muGrid_description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.90.1+40-g5bc73b30&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="w">                </span><span class="o">:</span><span class="n">muGrid_git_branch_is_dirty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="FFT.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Fast Fourier Transform</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="GettingStarted.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Getting Started</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2017-2022 Till Junge, 2018-2024 Lars Pastewka
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Python Bindings</a><ul>
<li><a class="reference internal" href="#fields">Fields</a></li>
<li><a class="reference internal" href="#multidimensional-arrays">Multidimensional arrays</a></li>
<li><a class="reference internal" href="#field-collections">Field collections</a></li>
<li><a class="reference internal" href="#components">Components</a></li>
<li><a class="reference internal" href="#sub-points">Sub-points</a></li>
<li><a class="reference internal" href="#convolutions">Convolutions</a></li>
<li><a class="reference internal" href="#array-accessors">Array accessors</a><ul>
<li><a class="reference internal" href="#subpt-vs-pixel-layout">SubPt vs Pixel layout</a></li>
<li><a class="reference internal" href="#with-vs-without-ghost-regions">With vs without ghost regions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#i-o">I/O</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=d41e3a40"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    </body>
</html>